<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>ä»Šå¤©åƒä»€ä¹ˆï¼Ÿ</title>
    <style>
      :root {
        /* --- V2 çš„æ¸…æ–°é…è‰² --- */
        --primary-color: #ff7f50; /* çŠç‘šæ©™ */
        --primary-dark: #e6683c;
        --secondary-color: #2ec4b6; /* è–„è·ç»¿ */
        --bg-gradient: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
        --card-bg: #ffffff;
        --text-color: #333333;
        --shadow-soft: 0 8px 25px rgba(0, 0, 0, 0.1);
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Microsoft YaHei',
          sans-serif;
        background: var(--bg-gradient);
        min-height: 100vh;
        margin: 0;
        padding: 15px; /* ç§»åŠ¨ç«¯è¾ƒå°çš„è¾¹è· */
        display: flex;
        justify-content: center;
        align-items: center;
        box-sizing: border-box;
        color: var(--text-color);
        /* ç¦æ­¢ç‚¹å‡»é«˜äº® */
        -webkit-tap-highlight-color: transparent;
      }

      /* ä¸»å¡ç‰‡ */
      .main-card {
        background: var(--card-bg);
        padding: 25px 20px; /* ç´§å‡‘çš„å†…è¾¹è· */
        border-radius: 25px;
        box-shadow: var(--shadow-soft);
        text-align: center;
        width: 100%;
        max-width: 480px; /* é™åˆ¶æœ€å¤§å®½åº¦ */
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      h1 {
        margin: 0 0 25px 0;
        font-weight: 800;
        font-size: 1.6rem;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 8px;
      }

      /* --- è½¬ç›˜æ ¸å¿ƒå®¹å™¨ (V3é€‚é…æŠ€æœ¯ + V2å…ƒç´ ) --- */
      .wheel-wrapper {
        position: relative;
        width: 88vw; /* å®½åº¦å å±å¹• 88% */
        max-width: 340px; /* æœ€å¤§ä¸è¶…è¿‡ 340px */
        aspect-ratio: 1 / 1; /* å¼ºåˆ¶ä¿æŒæ­£æ–¹å½¢ */
        margin: 0 auto 30px;
      }

      .canvas-container {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        border: 6px solid white; /* V2çš„ç™½è¾¹ */
        box-shadow: var(--shadow-soft);
        box-sizing: border-box;
        overflow: hidden;
        background: white;
        /* ä¿®å¤ç§»åŠ¨ç«¯ Safari åœ†è§’æº¢å‡º bug */
        transform: translateZ(0);
      }

      #canvas {
        width: 100%;
        height: 100%;
        display: block;
        border-radius: 50%;
        transition: transform 4s cubic-bezier(0.17, 0.84, 0.44, 1);
      }

      /* --- V2 çš„ç‰¹è‰²å…ƒç´  (æ”¹ä¸ºç™¾åˆ†æ¯”é€‚é…ç§»åŠ¨ç«¯) --- */

      /* ä¸­å¿ƒè£…é¥°ç›– */
      .wheel-hub {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 18%; /* ä½¿ç”¨ç™¾åˆ†æ¯”ç›¸å¯¹å¤§å° */
        height: 18%;
        background: white;
        border-radius: 50%;
        box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        z-index: 5;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.5rem; /* ä½¿ç”¨ç›¸å¯¹å­—ä½“å¤§å° */
      }

      /* V2 æ°´æ»´çŠ¶æŒ‡é’ˆ */
      .pointer {
        position: absolute;
        top: -8%; /* ä½¿ç”¨ç™¾åˆ†æ¯”å®šä½ */
        left: 50%;
        transform: translateX(-50%) rotate(45deg);
        width: 13%; /* ä½¿ç”¨ç™¾åˆ†æ¯”ç›¸å¯¹å¤§å° */
        height: 13%;
        background: var(--primary-color);
        border-radius: 50% 50% 0 50%; /* æ°´æ»´å½¢çŠ¶ */
        box-shadow: 0 4px 8px rgba(0, 0, 0, 0.2);
        z-index: 10;
      }
      /* æŒ‡é’ˆä¸­å¿ƒçš„å°ç™½ç‚¹ */
      .pointer::after {
        content: '';
        position: absolute;
        width: 25%;
        height: 25%;
        background: white;
        border-radius: 50%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      /* --- æ§åˆ¶åŒºåŸŸ (V3å¸ƒå±€ + V2æ ·å¼) --- */
      .controls-area {
        width: 100%;
        margin-bottom: 25px;
      }

      /* V2 æ¸å˜å¤§æŒ‰é’® */
      #spinBtn {
        background: linear-gradient(
          to right,
          var(--primary-color),
          var(--primary-dark)
        );
        color: white;
        font-size: 1.2rem;
        padding: 14px 0;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        font-weight: 800;
        box-shadow: 0 10px 20px -8px rgba(255, 127, 80, 0.5);
        transition: all 0.3s ease;
        width: 90%; /* ç§»åŠ¨ç«¯å®½åº¦ */
        margin-bottom: 20px;
        user-select: none;
      }

      #spinBtn:active {
        transform: scale(0.98);
      }

      #spinBtn:disabled {
        background: #ccc;
        box-shadow: none;
        cursor: not-allowed;
      }

      /* è¾“å…¥æ¡†ç»„ */
      .input-group {
        display: flex;
        gap: 8px;
        justify-content: center;
        width: 95%;
        margin: 0 auto;
      }

      input {
        flex: 1;
        padding: 12px 18px;
        border: 2px solid #eee;
        border-radius: 50px;
        outline: none;
        /* å…³é”®ï¼š16px é˜²æ­¢iOSè‡ªåŠ¨ç¼©æ”¾ */
        font-size: 16px;
        transition: border-color 0.3s;
        background: #fafafa;
      }

      input:focus {
        border-color: var(--secondary-color);
        background: white;
      }

      #addBtn {
        padding: 0 22px;
        background-color: var(--secondary-color);
        color: white;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        font-weight: bold;
        font-size: 15px;
        white-space: nowrap;
        transition: background 0.3s;
      }

      /* --- é€‰é¡¹åˆ—è¡¨ (V2æ ·å¼ + V3æ»šåŠ¨) --- */
      .options-list {
        list-style: none;
        padding: 0;
        display: flex;
        flex-wrap: wrap;
        gap: 10px;
        justify-content: center;
        width: 100%;
        max-height: 180px; /* é™åˆ¶é«˜åº¦ */
        overflow-y: auto; /* å…è®¸æ»šåŠ¨ */
        -webkit-overflow-scrolling: touch; /* iOSæµç•…æ»šåŠ¨ */
      }

      .tag {
        background: #f0f2f5;
        color: #555;
        padding: 8px 15px;
        border-radius: 25px;
        display: flex;
        align-items: center;
        gap: 8px;
        font-size: 14px;
        font-weight: 500;
      }

      .delete-btn {
        color: #ff6b6b;
        cursor: pointer;
        background: white;
        width: 20px;
        height: 20px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 14px;
        line-height: 1;
        box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
      }

      /* --- V2 çš„å¼¹çª—æ ·å¼ --- */
      #resultModal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(5px); /* æ¯›ç»ç’ƒèƒŒæ™¯ */
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 100;
        padding: 20px;
      }

      .modal-content {
        background: white;
        padding: 30px 25px;
        border-radius: 30px;
        text-align: center;
        width: 100%;
        max-width: 320px;
        box-shadow: var(--shadow-soft);
        animation: popUp 0.4s cubic-bezier(0.17, 0.67, 0.27, 1.26);
      }

      @keyframes popUp {
        from {
          transform: scale(0.6);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      .modal-emoji {
        font-size: 4rem;
        display: block;
        margin-bottom: 10px;
        animation: shake 1s ease-in-out;
      }

      @keyframes shake {
        0%,
        100% {
          transform: rotate(0);
        }
        25% {
          transform: rotate(-10deg);
        }
        75% {
          transform: rotate(10deg);
        }
      }

      .modal-result {
        font-size: 2.2rem;
        color: var(--primary-color);
        margin: 15px 0 30px;
        font-weight: 900;
        word-break: break-word;
      }

      .modal-btn {
        padding: 12px 0;
        width: 85%;
        background: var(--secondary-color);
        color: white;
        border: none;
        border-radius: 50px;
        font-size: 1.1rem;
        font-weight: bold;
        cursor: pointer;
        box-shadow: 0 5px 15px rgba(46, 196, 182, 0.3);
      }
    </style>
  </head>
  <body>
    <div class="main-card">
      <h1>ğŸ½ï¸ ä»Šå¤©åƒä»€ä¹ˆï¼Ÿ</h1>

      <div class="wheel-wrapper">
        <div class="pointer"></div>
        <div class="wheel-hub">ğŸ˜‹</div>
        <div class="canvas-container">
          <canvas
            id="canvas"
            width="800"
            height="800"
          ></canvas>
        </div>
      </div>

      <div class="controls-area">
        <button
          id="spinBtn"
          onclick="spin()"
          >âœ¨ å¼€å§‹å†³å®š âœ¨</button
        >

        <div class="input-group">
          <input
            type="text"
            id="newOption"
            placeholder="åŠ ä¸ªæƒ³åƒçš„ (å¦‚: ç‚¸é¸¡)"
            autocomplete="off"
          />
          <button
            id="addBtn"
            onclick="addOption()"
            >æ·»åŠ </button
          >
        </div>
      </div>

      <ul
        class="options-list"
        id="list"
      >
      </ul>
    </div>

    <div
      id="resultModal"
      onclick="closeModal()"
    >
      <div
        class="modal-content"
        onclick="event.stopPropagation()"
      >
        <span class="modal-emoji">ğŸ‰</span>
        <p style="color: #888; margin: 0">å¤©æ„å†³å®šä»Šæ™šåƒ...</p>
        <div
          class="modal-result"
          id="finalResult"
          >...</div
        >
        <button
          class="modal-btn"
          onclick="closeModal()"
          >æˆ‘å°±çŸ¥é“ï¼</button
        >
      </div>
    </div>

    <script>
      // é»˜è®¤é€‰é¡¹ (å¸¦ç‚¹è¡¨æƒ…æ›´ç”ŸåŠ¨)
      let options = [
        'éº¦å½“åŠ³ ğŸ”',
        'ç«é”… ğŸ²',
        'çƒ§çƒ¤ ğŸ¢',
        'è½»é£Ÿæ²™æ‹‰ ğŸ¥—',
        'éº»è¾£çƒ« ğŸŒ¶ï¸',
        'æ—¥æ–™å¯¿å¸ ğŸ£'
      ]

      // V2 çš„æŸ”å’Œè‰²è°ƒåº“
      const colors = [
        '#FFADAD',
        '#FFD6A5',
        '#FDFFB6',
        '#CAFFBF',
        '#9BF6FF',
        '#A0C4FF',
        '#BDB2FF',
        '#FFC6FF'
      ]

      const canvas = document.getElementById('canvas')
      const ctx = canvas.getContext('2d')
      const listEl = document.getElementById('list')

      let currentRotation = 0
      let isSpinning = false

      // åˆå§‹åŒ–
      window.onload = function () {
        renderList()
        drawWheel()
      }

      // ç›‘å¬å›è½¦é”®
      document
        .getElementById('newOption')
        .addEventListener('keypress', function (e) {
          if (e.key === 'Enter') addOption()
        })

      // ç»˜åˆ¶è½¬ç›˜ (ä½¿ç”¨é«˜åˆ†è¾¨ç‡ç»˜åˆ¶)
      function drawWheel() {
        const num = options.length
        if (num === 0) return

        // ä½¿ç”¨ 800x800 çš„åˆ†è¾¨ç‡è¿›è¡Œç»˜åˆ¶ï¼Œä¿è¯æ‰‹æœºç«¯æ¸…æ™°åº¦
        const size = 800
        const center = size / 2
        // åŠå¾„ç¨å¾®ç•™ç‚¹è¾¹è·
        const radius = size / 2 - 10
        const arcSize = (2 * Math.PI) / num

        ctx.clearRect(0, 0, size, size)

        for (let i = 0; i < num; i++) {
          const angle = i * arcSize - Math.PI / 2 // -90åº¦å¼€å§‹

          // ç»˜åˆ¶æ‰‡å½¢
          ctx.beginPath()
          ctx.fillStyle = colors[i % colors.length]
          ctx.moveTo(center, center)
          ctx.arc(center, center, radius, angle, angle + arcSize)
          ctx.fill()

          // V2 é£æ ¼çš„ç™½è‰²æè¾¹åˆ†å‰²çº¿
          ctx.strokeStyle = '#ffffff'
          ctx.lineWidth = 8
          ctx.stroke()
          ctx.save()

          // ç»˜åˆ¶æ–‡å­—
          ctx.translate(center, center)
          ctx.rotate(angle + arcSize / 2)
          ctx.textAlign = 'right'
          ctx.fillStyle = '#4a4a4a'

          // åŠ¨æ€è°ƒæ•´å­—ä½“å¤§å°ï¼Œé€‰é¡¹å¤šæ—¶å­—ä½“å˜å°
          let fontSize = num > 8 ? 32 : 42
          ctx.font = `800 ${fontSize}px 'Microsoft YaHei', sans-serif`

          // æ–‡å­—ä½ç½®å¾®è°ƒ
          ctx.fillText(options[i], radius - 40, 15)
          ctx.restore()
        }
      }

      // æ¸²æŸ“åˆ—è¡¨
      function renderList() {
        listEl.innerHTML = ''
        options.forEach((item, index) => {
          const li = document.createElement('li')
          li.className = 'tag'
          // ç®€å•çš„æ­£åˆ™åŒ¹é…ä¸­è‹±æ–‡å’Œæ•°å­—ï¼Œè¿‡æ»¤æ‰è‡ªå¸¦çš„emojiæ˜¾ç¤ºåœ¨æ ‡ç­¾é‡Œ(å¯é€‰)
          let textOnly = item.replace(/[^\u4e00-\u9fa5a-zA-Z0-9]/g, '')
          if (textOnly === '') textOnly = item

          li.innerHTML = `
                ${textOnly}
                <span class="delete-btn" onclick="removeOption(${index})">Ã—</span>
            `
          listEl.appendChild(li)
        })
      }

      // æ·»åŠ é€‰é¡¹
      function addOption() {
        const input = document.getElementById('newOption')
        const val = input.value.trim()
        if (val) {
          // V2 çš„åŠŸèƒ½ï¼šè‡ªåŠ¨éšæœºåŠ ä¸ªè¡¨æƒ…
          const foodEmojis = ['ğŸ±', 'ğŸ›', 'ğŸœ', 'ğŸ', 'ğŸ—', 'ğŸ¥Ÿ', 'ğŸ¥¡', 'ğŸ¥‘']
          const randomEmoji =
            foodEmojis[Math.floor(Math.random() * foodEmojis.length)]

          options.push(val + ' ' + randomEmoji)
          input.value = ''
          renderList()
          drawWheel()
        }
      }

      // åˆ é™¤é€‰é¡¹
      function removeOption(index) {
        if (isSpinning) return
        if (options.length <= 1) {
          alert('è‡³å°‘ä¿ç•™ä¸€ä¸ªé€‰é¡¹å“¦ï¼')
          return
        }
        options.splice(index, 1)
        renderList()
        drawWheel()
      }

      // è½¬åŠ¨é€»è¾‘
      function spin() {
        if (isSpinning || options.length === 0) return

        isSpinning = true
        const spinBtn = document.getElementById('spinBtn')
        spinBtn.disabled = true
        spinBtn.innerHTML = 'ğŸ¤” æ€è€ƒä¸­...'

        const randomDegree = Math.floor(Math.random() * 360)
        const extraSpins = 360 * 8 // å¤šè½¬å‡ åœˆ
        const totalRotate = currentRotation + extraSpins + randomDegree

        canvas.style.transform = `rotate(${totalRotate}deg)`
        currentRotation = totalRotate

        // ç­‰å¾…åŠ¨ç”»ç»“æŸ
        setTimeout(() => {
          showResult(totalRotate)
          isSpinning = false
          spinBtn.disabled = false
          spinBtn.innerHTML = 'âœ¨ å¼€å§‹å†³å®š âœ¨'
        }, 4000)
      }

      // è®¡ç®—ç»“æœ
      function showResult(rotation) {
        const actualDeg = rotation % 360
        const arcSize = 360 / options.length
        // æŒ‡é’ˆåœ¨é¡¶éƒ¨ï¼Œè®¡ç®—æ–¹å¼
        const index = Math.floor(((360 - (actualDeg % 360)) % 360) / arcSize)
        const winner = options[index]

        document.getElementById('finalResult').innerText = winner
        document.getElementById('resultModal').style.display = 'flex'
      }

      function closeModal() {
        document.getElementById('resultModal').style.display = 'none'
      }
    </script>
  </body>
</html>
