<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>ä»Šå¤©åƒä»€ä¹ˆï¼Ÿç§»åŠ¨ç‰ˆ</title>
    <style>
      :root {
        --primary-color: #ff7f50;
        --primary-dark: #e6683c;
        --secondary-color: #2ec4b6;
        --bg-gradient: linear-gradient(135deg, #f6d365 0%, #fda085 100%);
        --card-bg: #ffffff;
        --text-color: #333;
        --shadow-soft: 0 4px 20px rgba(0, 0, 0, 0.08);
      }

      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          'Helvetica Neue', Arial, sans-serif;
        background: var(--bg-gradient);
        min-height: 100vh;
        margin: 0;
        padding: 10px; /* æ‰‹æœºç«¯å‡å°å¤–è¾¹è· */
        display: flex;
        justify-content: center;
        align-items: center; /* å‚ç›´å±…ä¸­ */
        box-sizing: border-box;
        color: var(--text-color);
        -webkit-tap-highlight-color: transparent; /* å»é™¤ç‚¹å‡»é«˜äº® */
      }

      .main-card {
        background: var(--card-bg);
        padding: 25px 15px; /* å‡å°å†…è¾¹è· */
        border-radius: 20px;
        box-shadow: var(--shadow-soft);
        text-align: center;
        width: 100%;
        max-width: 450px; /* ç”µè„‘ç«¯æœ€å¤§å®½åº¦ */
        position: relative;
        overflow: hidden;
        display: flex;
        flex-direction: column;
        align-items: center;
      }

      h1 {
        margin: 0 0 20px 0;
        font-size: 1.5rem; /* è°ƒæ•´æ ‡é¢˜å¤§å° */
        font-weight: 800;
        color: #444;
      }

      /* --- è½¬ç›˜æ ¸å¿ƒé€‚é… --- */
      .wheel-wrapper {
        position: relative;
        width: 85vw; /* å®½åº¦å å±å¹•85% */
        max-width: 320px; /* æœ€å¤§ä¸è¶…è¿‡320px */
        aspect-ratio: 1 / 1; /* ä¿æŒæ­£æ–¹å½¢æ¯”ä¾‹ */
        margin: 0 auto 25px;
      }

      .canvas-container {
        width: 100%;
        height: 100%;
        border-radius: 50%;
        border: 6px solid white;
        box-shadow: 0 5px 15px rgba(0, 0, 0, 0.15);
        box-sizing: border-box;
        overflow: hidden;
        background: white;
        /* è§£å†³ç§»åŠ¨ç«¯Safariåœ†è§’æº¢å‡ºbug */
        transform: translateZ(0);
      }

      #canvas {
        width: 100%;
        height: 100%;
        display: block;
        border-radius: 50%;
        transition: transform 4s cubic-bezier(0.17, 0.84, 0.44, 1);
      }

      /* ä¸­å¿ƒè£…é¥° */
      .wheel-hub {
        position: absolute;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 18%; /* ç›¸å¯¹å°ºå¯¸ */
        height: 18%;
        background: white;
        border-radius: 50%;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        z-index: 5;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 1.5rem;
      }

      /* æŒ‡é’ˆ */
      .pointer {
        position: absolute;
        top: -6%; /* ç›¸å¯¹ä½ç½® */
        left: 50%;
        transform: translateX(-50%) rotate(45deg);
        width: 12%; /* ç›¸å¯¹å°ºå¯¸ */
        height: 12%;
        background: var(--primary-color);
        border-radius: 50% 50% 0 50%;
        box-shadow: 0 3px 5px rgba(0, 0, 0, 0.2);
        z-index: 10;
      }
      .pointer::after {
        content: '';
        position: absolute;
        width: 25%;
        height: 25%;
        background: white;
        border-radius: 50%;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
      }

      /* --- æŒ‰é’®ä¸è¾“å…¥ --- */
      .controls-area {
        width: 100%;
        margin-bottom: 20px;
      }

      #spinBtn {
        background: linear-gradient(
          to right,
          var(--primary-color),
          var(--primary-dark)
        );
        color: white;
        font-size: 1.1rem;
        padding: 14px 0;
        border: none;
        border-radius: 50px;
        cursor: pointer;
        font-weight: bold;
        box-shadow: 0 8px 15px -5px rgba(255, 127, 80, 0.5);
        width: 90%; /* æŒ‰é’®å®½åº¦ */
        margin-bottom: 20px;
        /* ç¦æ­¢æ–‡å­—è¢«é€‰ä¸­ */
        user-select: none;
        -webkit-user-select: none;
      }

      #spinBtn:active {
        transform: scale(0.98);
      }

      #spinBtn:disabled {
        background: #ddd;
        box-shadow: none;
        color: #999;
      }

      .input-group {
        display: flex;
        justify-content: center;
        gap: 8px;
        width: 95%;
        margin: 0 auto;
      }

      input {
        flex: 1;
        padding: 10px 15px;
        border: 2px solid #eee;
        border-radius: 50px;
        outline: none;
        /* 16pxé˜²æ­¢iOSç¼©æ”¾ */
        font-size: 16px;
        background: #fafafa;
      }

      input:focus {
        border-color: var(--secondary-color);
        background: white;
      }

      #addBtn {
        padding: 0 20px;
        background-color: var(--secondary-color);
        color: white;
        border: none;
        border-radius: 50px;
        font-weight: bold;
        font-size: 14px;
        white-space: nowrap;
      }

      /* --- é€‰é¡¹åˆ—è¡¨ --- */
      .options-list {
        list-style: none;
        padding: 0;
        display: flex;
        flex-wrap: wrap;
        gap: 8px;
        justify-content: center;
        width: 100%;
        max-height: 150px; /* é™åˆ¶é«˜åº¦é˜²æ­¢å æ»¡å±å¹• */
        overflow-y: auto; /* å…è®¸åˆ—è¡¨æ»šåŠ¨ */
      }

      .tag {
        background: #f0f2f5;
        color: #555;
        padding: 6px 12px;
        border-radius: 15px;
        display: flex;
        align-items: center;
        gap: 6px;
        font-size: 14px;
      }

      .delete-btn {
        color: #ff6b6b;
        background: rgba(0, 0, 0, 0.05);
        width: 18px;
        height: 18px;
        border-radius: 50%;
        display: flex;
        justify-content: center;
        align-items: center;
        font-size: 12px;
        line-height: 1;
      }

      /* --- å¼¹çª—é€‚é… --- */
      #resultModal {
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(0, 0, 0, 0.6);
        backdrop-filter: blur(3px);
        display: none;
        justify-content: center;
        align-items: center;
        z-index: 100;
        padding: 20px; /* é˜²æ­¢è´´è¾¹ */
      }

      .modal-content {
        background: white;
        padding: 30px 20px;
        border-radius: 20px;
        text-align: center;
        width: 100%;
        max-width: 300px;
        animation: popUp 0.3s cubic-bezier(0.17, 0.67, 0.27, 1.26);
      }

      @keyframes popUp {
        from {
          transform: scale(0.8);
          opacity: 0;
        }
        to {
          transform: scale(1);
          opacity: 1;
        }
      }

      .modal-result {
        font-size: 2rem;
        color: var(--primary-color);
        margin: 15px 0 25px;
        font-weight: 900;
        word-break: break-all; /* é˜²æ­¢é•¿è¯æ’‘ç ´ */
      }

      .modal-btn {
        padding: 12px 0;
        width: 80%;
        background: var(--secondary-color);
        color: white;
        border: none;
        border-radius: 50px;
        font-size: 16px;
        font-weight: bold;
      }
    </style>
  </head>
  <body>
    <div class="main-card">
      <h1>ğŸ½ï¸ ä»Šå¤©åƒä»€ä¹ˆï¼Ÿ</h1>

      <div class="wheel-wrapper">
        <div class="pointer"></div>
        <div class="wheel-hub">ğŸ˜‹</div>
        <div class="canvas-container">
          <canvas
            id="canvas"
            width="800"
            height="800"
          ></canvas>
        </div>
      </div>

      <div class="controls-area">
        <button
          id="spinBtn"
          onclick="spin()"
          >ğŸ‘‰ å¼€å§‹å†³å®š ğŸ‘ˆ</button
        >

        <div class="input-group">
          <input
            type="text"
            id="newOption"
            placeholder="åŠ ä¸ªèœ (å¦‚: çƒ¤è‚‰)"
            autocomplete="off"
          />
          <button
            id="addBtn"
            onclick="addOption()"
            >æ·»åŠ </button
          >
        </div>
      </div>

      <ul
        class="options-list"
        id="list"
      >
      </ul>
    </div>

    <div
      id="resultModal"
      onclick="closeModal()"
    >
      <div
        class="modal-content"
        onclick="event.stopPropagation()"
      >
        <div style="font-size: 3rem; margin-bottom: 10px">ğŸ‰</div>
        <div style="color: #888">å¤©æ„å†³å®šä»Šæ™šåƒ</div>
        <div
          class="modal-result"
          id="finalResult"
          >...</div
        >
        <button
          class="modal-btn"
          onclick="closeModal()"
          >å®Œç¾ï¼</button
        >
      </div>
    </div>

    <script>
      // é»˜è®¤é€‰é¡¹
      let options = [
        'éº¦å½“åŠ³',
        'ç«é”…',
        'çƒ§çƒ¤',
        'è½»é£Ÿæ²™æ‹‰',
        'éº»è¾£çƒ«',
        'æ—¥æ–™å¯¿å¸',
        'å…°å·æ‹‰é¢',
        'KFC'
      ]

      // æ›´åŠ é²œäº®çš„é…è‰²
      const colors = [
        '#FFADAD',
        '#FFD6A5',
        '#FDFFB6',
        '#CAFFBF',
        '#9BF6FF',
        '#A0C4FF',
        '#BDB2FF',
        '#FFC6FF'
      ]

      const canvas = document.getElementById('canvas')
      const ctx = canvas.getContext('2d')
      const listEl = document.getElementById('list')

      let currentRotation = 0
      let isSpinning = false

      // é¡µé¢åŠ è½½
      window.onload = function () {
        renderList()
        drawWheel()
      }

      // ç›‘å¬å›è½¦é”® (æ‰‹æœºè½¯é”®ç›˜ä¸Šçš„"å‰å¾€"æˆ–"æ¢è¡Œ"é€šå¸¸è§¦å‘keycode 13)
      document
        .getElementById('newOption')
        .addEventListener('keypress', function (e) {
          if (e.key === 'Enter') addOption()
        })

      function drawWheel() {
        const num = options.length
        if (num === 0) return

        // å¢åŠ åˆ†è¾¨ç‡ä»¥ä¿è¯åœ¨é«˜æ¸…æ‰‹æœºå±ä¸Šçš„æ¸…æ™°åº¦
        const size = 800
        const center = size / 2
        const radius = size / 2 - 10 // ç•™ä¸€ç‚¹è¾¹è·
        const arcSize = (2 * Math.PI) / num

        ctx.clearRect(0, 0, size, size)

        for (let i = 0; i < num; i++) {
          const angle = i * arcSize - Math.PI / 2

          ctx.beginPath()
          ctx.fillStyle = colors[i % colors.length]
          ctx.moveTo(center, center)
          ctx.arc(center, center, radius, angle, angle + arcSize)
          ctx.fill()

          // åˆ†å‰²çº¿
          ctx.strokeStyle = '#ffffff'
          ctx.lineWidth = 8 // åŠ ç²—åˆ†å‰²çº¿
          ctx.stroke()

          ctx.save()
          ctx.translate(center, center)
          ctx.rotate(angle + arcSize / 2)
          ctx.textAlign = 'right'
          ctx.fillStyle = '#4a4a4a'
          // æ ¹æ®é€‰é¡¹æ•°é‡åŠ¨æ€è°ƒæ•´å­—å·ï¼Œé¿å…å¤ªæŒ¤
          let fontSize = num > 8 ? 30 : 40
          ctx.font = `bold ${fontSize}px sans-serif`
          ctx.fillText(options[i], radius - 40, 15)
          ctx.restore()
        }
      }

      function renderList() {
        listEl.innerHTML = ''
        options.forEach((item, index) => {
          const li = document.createElement('li')
          li.className = 'tag'
          li.innerHTML = `
                ${item}
                <div class="delete-btn" onclick="removeOption(${index})">Ã—</div>
            `
          listEl.appendChild(li)
        })
      }

      function addOption() {
        const input = document.getElementById('newOption')
        const val = input.value.trim()
        if (val) {
          options.push(val)
          input.value = ''
          // æ‰‹æœºä¸Šæ·»åŠ å®Œæ”¶èµ·é”®ç›˜ä½“éªŒæ›´å¥½ï¼Œæˆ–è€…ä¿æŒç„¦ç‚¹ç»§ç»­è¾“å…¥
          // input.blur();
          renderList()
          drawWheel()
        }
      }

      function removeOption(index) {
        if (isSpinning) return
        if (options.length <= 1) {
          alert('ä¸èƒ½å†åˆ å•¦ï¼')
          return
        }
        options.splice(index, 1)
        renderList()
        drawWheel()
      }

      function spin() {
        if (isSpinning || options.length === 0) return

        isSpinning = true
        const spinBtn = document.getElementById('spinBtn')
        spinBtn.disabled = true

        const randomDegree = Math.floor(Math.random() * 360)
        const extraSpins = 360 * 10 // è½¬10åœˆ
        const totalRotate = currentRotation + extraSpins + randomDegree

        canvas.style.transform = `rotate(${totalRotate}deg)`
        currentRotation = totalRotate

        setTimeout(() => {
          showResult(totalRotate)
          isSpinning = false
          spinBtn.disabled = false
        }, 4000)
      }

      function showResult(rotation) {
        const actualDeg = rotation % 360
        const arcSize = 360 / options.length
        // ä¿®æ­£è§’åº¦è®¡ç®—
        const index = Math.floor(((360 - (actualDeg % 360)) % 360) / arcSize)

        document.getElementById('finalResult').innerText = options[index]
        document.getElementById('resultModal').style.display = 'flex'
      }

      function closeModal() {
        document.getElementById('resultModal').style.display = 'none'
      }
    </script>
  </body>
</html>
